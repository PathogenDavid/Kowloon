@page "/admin"
@using Kowloon.Core;

@foreach (IRenderer renderer in Program.Kowloon.TestRenderers)
{
    <button class="@PatternButtonClass(renderer)" @onclick="e => Program.Kowloon.SetTestRenderer(renderer)">@renderer.GetType().Name</button>

    @if (renderer is IRangedTest rangedTest)
    {
        <input class="@PatternButtonClass(renderer)" type="number" value="@rangedTest.Value" @onchange="e => UpdateRangedTest(rangedTest, e.Value?.ToString())" />
    }

    <br>
}
<button class="@PatternButtonClass(null)" @onclick="e => Program.Kowloon.DisableTestRenderer()" style="font-weight: bold">Resume normal operation</button><br>

Brightness: <input type="number" value="@Program.Kowloon.Brightness" @onchange="e => UpdateBrightness(e.Value?.ToString())" /><br>

@code
{
    private string PatternButtonClass(IRenderer renderer)
        => Program.Kowloon.CurrentTestRenderer == renderer ? "selected" : "";

    private static void UpdateRangedTest(IRangedTest rangedTest, string newValue)
    {
        if (int.TryParse(newValue, out int newIntegerValue))
        { UpdateRangedTest(rangedTest, newIntegerValue); }
        else
        { Console.Error.WriteLine($"Received invalid ranged value for {rangedTest.GetType()}, request ignored."); }
    }

    private static void UpdateRangedTest(IRangedTest rangedTest, int newValue)
    {
        Program.Kowloon.SetTestRenderer(rangedTest);

        if (newValue < rangedTest.MinimumValue)
        { newValue = rangedTest.MaximumValue - 1; }
        else if (newValue >= rangedTest.MaximumValue)
        { newValue = rangedTest.MinimumValue; }

        rangedTest.Value = newValue;
    }

    private static void UpdateBrightness(string newBrightness)
    {
        if (byte.TryParse(newBrightness, out byte newBrightnessValue))
        { Program.Kowloon.Brightness = newBrightnessValue; }
        else
        { Console.Error.WriteLine($"Received invalid brightness value, request ignored."); }
    }
}
